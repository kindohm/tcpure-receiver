<!DOCTYPE html>
<html>

<head>
  <script src="webmidi.js"></script>
  <script type="module">


    const onEnabled = () => {

      WebMidi.inputs.forEach((device, index) => {
        console.log(`${index}: ${device.name}`);
      });

      const twister = WebMidi.inputs.find(i => i.name.toLowerCase().includes('twister'));
      if (!twister) {
        return;
      }

      twister.channels[1].addListener("controlchange", async (e) => {
        console.log(e.controller.number + ': ' + e.value);


        const response = await fetch('/send',
          {
            method: 'post', headers: {
              'Content-Type': 'application/json'
            }, body: JSON.stringify({ cc: e.controller.number, value: e.value })
          });
        const data = await response.json();
        console.log('response', data);

      });


    }

    WebMidi
      .enable()
      .then(onEnabled)
      .catch(err => alert(err));

  </script>

</head>

<body>
  <h1>hi</h1>
</body>

</html>